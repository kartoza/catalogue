{# included in search.html or pulled in by ajax #}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}

  {% if myForm %}
    <div class="row-fluid gap-top center">
      <h3>Search Criteria<small> (you can optionally digitise a search area on the map)</small></h3>
      <div class="btn-group">
        <button class="btn" id="advancedSearch" title="Click here to switch between simple and advanced search modes." onClick="toggleAdvFields();"><span id="search-btn-text">{% if myAdvancedFlag %}Simple Search{% else %}Advanced Search{% endif %}</span></button>
        <input type="submit" class="btn btn-success" value="Search" class="default" name="_search" title="Click here to execute your search."/>
      </div>
    </div>
    <hr>
    <div class="row-fluid">
      <form enctype="multipart/form-data" action="{% url 'search' %}" method="post" id="search_form" class="span12 form-horizontal gap-top">
        {% csrf_token %}
        {{myForm.geometry}}
        <div class="span5">
          {% for field in myForm.visible_fields|slice:":9" %}
            <div class="control-group">
              <label class="control-label" for="{{field.html_name}}">{{field.label}}:</label>
              <div class="controls">
                {{field}}
              </div>
            </div>
          {% endfor %}
        </div> 
        <div class="span5">
          {% for field in myForm.visible_fields %}
          {% if forloop.counter >= 10 %}
            <div class="control-group">
              <label class="control-label" for="{{field.html_name}}">{{field.label}}:</label>
              <div class="controls">
                {{field}}
              </div>
            </div>
          {% endif %}
          {% endfor %}
        </div>        
      </form>
    {% else %}
      Error search form could not be loaded.
    {% endif %}
  </div>
<script type="text/javascript">
  var advFieldsFlag = false;

  $('[data-search-type="adv"]').each(function(){
    $(this).closest('.control-group').hide();
  });

  {% if myAdvancedFlag %}
  toggleAdvFields();
  advFieldsFlag = true;
  {% endif %}

  {% for myField in myForm %}
  {% ifnotequal myField.html_name "geometry" %}
  $("#{{myField.html_name}}Help").dialog({
    autoOpen: false,
    bgiframe: true,
    modal: true,
    buttons: {
      Ok: function() {
        $(this).dialog('close');
      }
    }
  });
    $('#{{myField.html_name}}Button').click(function(){
      $('#{{myField.html_name}}Help').dialog('open');
  });
  {% endifnotequal %}
  {% endfor %}


  function toggleAdvFields(){
    if(!advFieldsFlag){
      advFieldsFlag = true;
      $('[data-search-type="adv"]').each(function(){
        $(this).closest('.control-group').fadeIn('slow');
      });
      $('#search-btn-text').text('Simple Search');
    } else {
      advFieldsFlag = false;
      $('[data-search-type="adv"]').each(function(){
        $(this).closest('.control-group').fadeOut('slow');
      });
      $('#search-btn-text').text('Advanced Search');
    }
  }
</script>