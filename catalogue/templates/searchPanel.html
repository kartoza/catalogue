{# included in search.html or pulled in by ajax #}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}
  <div class="row-fluid">
    <h3 class="centered"><i class="icon-search icon-large"></i> Search criteria</h3>
    <h6>(you can optionally digitise a search area above)</h6>
  </div>
  <script type="text/javascript">
  $( function () {
   {#% if myAdvancedFlag %#}
   {# restyle the file choose using jquery stylefile plugin #}
       //$("input[type=file]").filestyle({ image: "/media/images/choose-file.gif", imageheight : 22, imagewidth : 160, width : 0 });

       {#% endif %#}

       {% for myField in myForm %}
       {% ifnotequal myField.html_name "geometry" %}
       $("#{{myField.html_name}}Help").dialog({
        autoOpen: false,
        bgiframe: true,
        modal: true,
        buttons: {
          Ok: function() {
            $(this).dialog('close');
          }
        }
      });
       $('#{{myField.html_name}}Button').click(function(){
        $('#{{myField.html_name}}Help').dialog('open');
      });
       {% endifnotequal %}
       {% endfor %}



      // datewidgetcontainer
      $('#dr_container').sansa_daterangecontainer();

        // for toggling advanced search on / off
        $('#advancedSearch').click(function(event){
          //console.log('clicked - val: ' + $('#id_isAdvanced').val());
          // if AS is active
          if($('#id_isAdvanced').val() == 'true') {
            // Hide all AS fields
            $('.adv_fld').hide('fast', function(){
              // Hide fieldset
              $('fieldset.adv_search_ui input:visible, fieldset.adv_search_ui select:visible').closest('fieldset').hide();
              $('#advancedSearch').val('Toggle Advanced Search');
              $('#id_isAdvanced').val('false');
            });
            // Release filters on sensors
            $('#id_sensors option').show().attr('disabled', false)
          } else {
            advSearchActivate($('#id_search_type').val());
            $('#advancedSearch').val('Toggle Simple Search');
            $('#id_isAdvanced').val('true');
          };
        });
        {% if myAdvancedFlag %}{# activate advanced search tab #}
        advSearchActivate({{ mySearchType }});
        {% endif %}
        $('#id_search_type').change(function(e){
          advSearchActivate(e.currentTarget.value);
        });
        $('#id_sensor_inclination_angle_start').change(check_sensor_inclination_angles);
        $('#id_sensor_inclination_angle_end').change(check_sensor_inclination_angles);
      });

    /*
    * @param num : search_type enum value
    */
    function advSearchActivate(search_type){
        if(typeof search_type == 'undefined') {
            search_type = 0;
        }
        //console.log('advSearchActivate:' + search_type);
        $('.adv_search_all').show('slow').closest('fieldset').show('slow');
        $('.adv_search_' + search_type).show('slow').closest('fieldset').show('slow');
        //debugger;
        $('.adv_fld').not('.adv_search_all, .adv_search_' + search_type).hide();
        $('fieldset').each(function(){
          if(!$(this).hasClass('simple_search') && !$(this).find('.adv_fld:visible').length) {
            $(this).hide();
          };
        });
        // Updates sensors selects
        // get_dictionary_options();
    };

    </script>

  {% if myForm %}
    <input type="button" class="btn" value="{% if myAdvancedFlag %}Toggle Simple Search{% else %}Toggle Advanced Search{% endif %}" id="advancedSearch" title="Click here to switch between simple and advanced search modes."/>
    <input type="submit" class="btn" value="Search" class="default" name="_search" title="Click here to execute your search."/>
    {# add additional form media, defined by form Media class #}
    {{ myForm.media }}
    <form enctype="multipart/form-data" action="{% url 'search' %}" method="post" id="search_form" class="form-horizontal">
      {% csrf_token %}
      {{ myForm.non_field_errors }}
      {{ myForm.isAdvanced }}
      {{ myForm.geometry }}


      {% for field in myForm.visible_fields %}
        <div class="control-group">
          <label class="control-label" for="{{field.html_name}}">{{field.label}}</label>
          <div class="controls">
            {{field.field}}
          </div>
        </div>
      {% endfor %}


    </form>
  {% else %}
    Error search form could not be loaded.
  {% endif %}
