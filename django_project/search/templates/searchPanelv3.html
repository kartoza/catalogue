{# included in search.html or pulled in by ajax #}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}
{% load crispy_forms_tags %}
{% crispy myForm %}
<button onClick="submitSearchForm();" class="btn btn-success" class="default" name="_search" title="Click here to execute your search.">Search</button>
{{myForm.media}}

<script>

    function createOptions(theOptions, theSelectedOptions, addEmpty){
      // add empty options, default true
      addEmpty = addEmpty !== undefined ? addEmpty : true;
      var options = '';
      if (addEmpty === true) {
        options += '<option value="">---------</option>';
      }
      $(theOptions).each(function (i,option){
        if (typeof(theSelectedOptions) === "object") {
          // use indexOf on complex object
          if (theSelectedOptions.indexOf(option[0]) != -1){
            options += '<option selected=selected value="' + option[0] + '">' + option[1] + '</option>';
          } else {
            options += '<option value="' + option[0] + '">' + option[1] + '</option>';
          }
        } else {
          if (option[0] == theSelectedOptions) {
            options += '<option selected=selected value="' + option[0] + '">' + option[1] + '</option>';
          } else {
            options += '<option value="' + option[0] + '">' + option[1] + '</option>';
          }
        }
      });
      return options
    }

    function getSelectOptions() {
      block();
      var sel_insttypes = [];
      $('#id_instrumenttype option:selected').each(function(i, selected) {
        sel_insttypes[i] = parseInt($(selected).val());
      });

      var sel_satellite = $('#id_satellite option:selected').val();
      var sel_spectralmode = $('#id_spectral_mode option:selected').val();
      var getData = {
        'instrumenttypes': sel_insttypes,
        'satellite': sel_satellite,
        'spectralmode': sel_spectralmode
      };

      $.getJSON('{% url "updateSelectOptions" %}', $.param(getData, true)).done(function(data){
        $("#id_instrumenttype").html(createOptions(data.instrumenttypes, sel_insttypes, false));

        $("#id_satellite").html(createOptions(data.satellites, sel_satellite));

        $("#id_spectral_mode").html(createOptions(data.spectralmodes, sel_spectralmode));
      });
      unblock();
    }

    function check_sensor_inclination_angles() {
        var sv = parseInt($("#id_sensor_inclination_angle_start").val());
        var ev = parseInt($("#id_sensor_inclination_angle_end").val());
        if (sv && ev && (sv > ev)) {
            alert ("The sensor inclination angle start value is greater than the end.");
        };
    };

    function submitSearchForm(){
      block();
      $('#search_form').ajaxForm({
        success: function(data) {
          loadSearchResults( 1, data.guid );
        },
        error: function(data) {
          $('#search-form-container').html(data.responseText);
          unblock();
        }
      });

      $("#search_form").submit();
    }

    $('#dr_container').sansa_daterangecontainer();
    $('#id_start_datepicker, #id_end_datepicker').datepicker({
      'autoclose':true
    });

    $("select").change(function (){
      getSelectOptions();
    });
</script>