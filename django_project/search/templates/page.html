{% extends "base-fluid.html" %}
{% load staticfiles %}
{% block body_load %}{% endblock %}

{% block content%}
  <div class="row-fluid">
    <div class="span12">
      <div id="search-panel">
        <div id="search-panel-search-button">
          <button class="btn btn-success btn-large btn-left-panel"
                  onclick="submitSearchForm();"
                  data-toggle="tooltip" title="Run Search"
                  data-placement="right">
            <i class="icon-play"></i>
          </button>
        </div>
        <div id="search-panel-reset-button">
          <button class="btn btn-warning btn-large btn-left-panel"
                  data-toggle="tooltip" title="Reset Search Parameters"
                  data-placement="right">
            <i class="icon-refresh"></i>
          </button>
        </div>
        <div id="search-panel-toggle">
          <button class="btn btn-info btn-large btn-left-panel"
                  onclick="toggleSearchPanel();"
                  data-toggle="tooltip" title="Toggle Search Panel"
                  data-placement="right">
            <i class="icon-search"></i>
          </button>
        </div>
        <section class="tabs">
          <input id="tab-1" type="radio" name="radio-set" class="tab-selector-1 chk-hide" checked />
          <label for="tab-1" class="tab-label-1">Satellite</label>

          <input id="tab-2" type="radio" name="radio-set" class="tab-selector-2 chk-hide" />
          <label for="tab-2" class="tab-label-2">Date Range</label>

          <input id="tab-3" type="radio" name="radio-set" class="tab-selector-3 chk-hide" />
          <label for="tab-3" class="tab-label-3">Area of Interest</label>

          <input id="tab-4" type="radio" name="radio-set" class="tab-selector-4 chk-hide" />
          <label for="tab-4" class="tab-label-4">Cloud Cover</label>

          <input id="tab-5" type="radio" name="radio-set" class="tab-selector-5 chk-hide" />
          <label for="tab-5" class="tab-label-5">Other</label>
<!--
          <input id="tab-6" type="radio" name="radio-set" class="tab-selector-6 chk-hide" />
          <label for="tab-6" class="tab-label-6"><i class="icon-camera"></i></label>-->
          <div class="clear-shadow"></div>
          <div class="content well custom-corner-top-right">
            <form id="catalogueSearch" action={% url 'submitSearch' %}>
              {% csrf_token %}
              {{ searchform.geometry }}
              {{ searchform.selected_sensors }}
              <div class="content-1 content_div">
                <h2>Satellite</h2>
                <hr />
                <span id="sattelite_inline" class="help-inline"></span>
                <div id="listTree" class="listTree"></div>
                <hr />
                <div class="search-options">
                  <label class="checkbox">
                    {{ searchform.free_imagery }} {{ searchform.free_imagery.label_tag }}
                  </label>
                  <label class="checkbox">
                    {{ searchform.panchromatic_imagery }} {{ searchform.panchromatic_imagery.label_tag }}
                  </label>
                </div>
                <hr />
                <div class="search-options">
                  <h3>Search summary</h3>
                </div>
              </div>
              <div class="content-2 content_div">
                <span id="daterange_inline" class="help-inline"></span>
                <div id="date_from_cg" class="control-group">
                  <label class="control-label" for="id_start_datepicker">Date from</label>
                  <div class="controls">
                    <input type="text" id="id_start_datepicker" placeholder="">
                  </div>
                </div>
                <div id="date_to_cg" class="control-group">
                  <label class="control-label" for="id_end_datepicker">Date to</label>
                  <div class="controls">
                    <input type="text" id="id_end_datepicker" placeholder="">
                    <span id="date_to_inline" class="help-inline"></span>
                  </div>
                </div>
                <div id="date_range">
                  <div class="date-range text-center">
                    <button class="btn">
                      <i class="icon-plus"></i> Add new date range
                    </button>
                  </div>
                  {{ dateformset.management_form }}
                  {% for form in dateformset.forms %}
                    {{ form.as_p }} {# TODO: this will FAIL , needs to be specifically formated for daterange widget #}
                  {% endfor %}
                </div>
              </div>
              <div class="content-3 content_div">
                <fieldset>
                  <label class="control-label" for="id_aoi_geometry">Bounding Box/Circle</label>
                  {{ searchform.aoi_geometry }}
                   <span class="help-block">{{ searchform.aoi_geometry.help_text }}</span>
                  <label class="control-label" for="id_geometry_file">Geometry file</label>
                  {{ searchform.geometry_file }}
                   <span class="help-block">{{ searchform.geometry_file.help_text }}</span>
                 </fieldset>
              </div>
              <div class="content-4 content_div">
                <fieldset>
                  <label for="id_cloud_mean">Cloud cover</label>
                  {{ searchform.cloud_mean }}
                  <span class="help-block">{{ searchform.cloud_mean.help_text }}</span>
                </fieldset>
              </div>
              <div class="content-5 content_div">
                <fieldset>
                <label for="id_k_orbit_path">Path (K/orbit)</label>
                {{ searchform.k_orbit_path }}
                <span class="help-block">{{ searchform.k_orbit_path.help_text }}</span>
                <label for="id_j_frame_row">Row (J/frame)</label>
                {{ searchform.j_frame_row }}
                <span class="help-block">{{ searchform.j_frame_row.help_text }}</span>
                <label for="id_sensor_inclination_angle_start">Sensor inclination angle start</label>
                {{ searchform.sensor_inclination_angle_start }}
                <span class="help-block">{{ searchform.sensor_inclination_angle_start.help_text }}</span>
                <label for="id_sensor_inclination_angle_end">Sensor inclination angle end</label>
                {{ searchform.sensor_inclination_angle_end }}
                <span class="help-block">{{ searchform.sensor_inclination_angle_end.help_text }}</span>
                <label class="control-label" for="id_spatial_resolution">Spatial resolution</label>
                {{ searchform.spatial_resolution }}
                <span class="help-block">{{ searchform.spatial_resolution.help_text }}</span>
                <label for="id_band_count">Band count</label>
                {{ searchform.band_count }}
                <span class="help-block">{{ searchform.band_count.help_text }}</span>
                </fieldset>
              </div>
              </form>
            </div>
          </div>
        </section>
      </div>
      <div id="cart-panel" class="well">
        <div id="cart-panel-order-button">
          <button class="btn btn-success btn-large btn-left-panel"
                  data-toggle="tooltip" title="Place Order"
                  data-placement="right">
            <i class="icon-ok"></i>
          </button>
        </div>
        <div id="cart-panel-download-button">
          <button class="btn btn-info btn-large btn-left-panel"
                  data-toggle="tooltip"
                  data-title="Toggle Download Options"
                  data-placement="right">
            <i class="icon-download-alt"></i>
          </button>
        </div>
        <div id="cart-panel-download-button-shp" class="downloadcartoptions">
          <button class="btn btn-info btn-left-panel"
                  data-toggle="tooltip"
                  data-title="Download as SHP"
                  data-placement="right">SHP</button>
        </div>
        <div id="cart-panel-download-button-kml" class="downloadcartoptions">
          <button class="btn btn-info btn-left-panel" data-toggle="tooltip"
                  data-title="Download as KML"
                  data-placement="right">KML</button>
        </div>
        <div id="cart-panel-download-button-kmz" class="downloadcartoptions">
          <button class="btn btn-info btn-left-panel"
                  data-toggle="tooltip"
                  data-title="Download as KMZ"
                  data-placement="right">KMZ</button>
        </div>
        <div id="cart-panel-download-button-xml" class="downloadcartoptions">
          <button class="btn btn-info btn-left-panel"
                  data-toggle="tooltip"
                  data-title="Download as XML"
                  data-placement="right">XML</button>
        </div>
        <div id="cart-panel-download-button-htm" class="downloadcartoptions">
          <button class="btn btn-info btn-left-panel"
                  data-toggle="tooltip"
                  data-title="Download as HTM"
                  data-placement="right">HTM</button>
        </div>
        <div id="cart-panel-toggle">
          <button class="btn btn-info btn-large btn-left-panel" onclick="toggleCartPanel();"
              data-toggle="tooltip" data-title="Toggle Cart Panel"
              data-placement="right">
            <i class="icon-shopping-cart"></i>
          </button>
        </div>
        <div id="cart-container">
        </div>
      </div>

      <div id="result-panel" class="well">
        <div id="result-panel-download-button">
          <button class="btn btn-success btn-large btn-right-panel"
                  data-toggle="tooltip" data-title="Toggle Download Options"
                  data-placement="left">
            <i class="icon-download-alt"></i>
          </button>
        </div>
        <div id="result-panel-download-button-shp" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as SHP"
                  data-placement="left">SHP</button>
        </div>
        <div id="result-panel-download-button-kml" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as KML"
                  data-placement="left">KML</button>
        </div>
        <div id="result-panel-download-button-kmz" class="downloadoptions">
          <p class="btn btn-info btn-right-panel" data-toggle="tooltip"
             data-title="Download as KMZ"
             data-placement="left">KMZ</p>
        </div>
        <div id="result-panel-download-button-xml" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as XML"
                  data-placement="left">XML</button>
        </div>
        <div id="result-panel-download-button-htm" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as HTM"
                  data-placement="left">HTM</button>
        </div>
        <div id="result-panel-toggle">
          <button class="btn btn-info btn-large btn-right-panel"
                  onclick="toggleResultPanel();"
                  data-toggle="tooltip" data-placement="left"
                  title="Toggle Results Panel">
            <i class="icon-list"></i>
          </button>
        </div>
        <div class="navigation">
          <div id="searchPrev" class="btn searchPrev" style="float:left; display: none;">
            <i class="icon-chevron-left"></i>
          </div>
          <div class="position" id="resultsPosition"></div>
          <div id="searchNext" class="btn searchNext" style="float:right; display: none;">
            <i class="icon-chevron-right"></i>
          </div>
        </div>
        <div id="results-container"></div>
        <div class="summary" id="resultsSummary"></div>
      </div>

      <div id="map"></div>
      <div id="svg_layer">
        <svg id="svg" style="width:100%; height: 100%;"></svg>
      </div>
      <input type="hidden" id="id_geometry" />
      <div id="map-controls">
        <div id="map-layerswitcher-control">
          <button class="btn btn-info btn-large right icon-globe"></button>
        </div>
        <div id="map-navigation"></div>
      </div>
      <div id="map-controls2" class="blackalpha60">
        <div id="map-control-position"></div>
        <div id="map-control-scalebar"></div>
      </div>
      <div id="map-layerswitcher" class="drop-shadow"></div>
    </div>
  </div>
  <div id="ajax-modal" class="modal hide fade" tabindex="-1"></div>
  <div id="imageBox" class="modal container hide fade text-center"  tabindex="-2">
    <img id="imageBoximage" src="" />
  </div>
{% endblock%}

{% block extrajs %}
  {{ block.super }}
  <script type="text/javascript">
    {% if user.is_authenticated %}
      var UserLoged = true;
    {% else %}
      var UserLoged = false;
    {% endif %}
  </script>
  <script type="text/javascript" src="{% static 'js/search.js' %}"></script>
  <script>
  $( document ).ready(function() {
    $('button[data-toggle="tooltip"]').tooltip();

    myMap = new APP.SansaMap('map');
    searchLayer = new APP.SearchLayer(myMap);
    geoSearchLayer = new APP.GeoSearchLayer(myMap);

    $(".olButton").tooltip({"placement": "top"});

    defaultPanelState();
    $('.listTree').listTree( {{ listreeoptions|safe }} , { "startCollapsed": true, "selected": [] });
    $('#results-container').perfectScrollbar( { wheelSpeed: 20 } );
    $('#cart-container').perfectScrollbar( { wheelSpeed: 20 } );
    $('#id_start_datepicker').datepicker({
      autoclose: true
    });
    $('#id_end_datepicker').datepicker({
      autoclose: true
    });
    $('#result-panel-download-button').click(function() {
      toggleResultDownloadButton();
    });
    $('#cart-panel-download-button').click(function() {
      toggleCartDownloadButton();
    });
    $('#map-layerswitcher-control').click(function() {
      toggleLayerSwitcher();
    });
    $('#result-panel-download-button-shp').click(function() {
      window.open(
        '/downloadsearchresults/' + APP.guid + '/?shp',
        '_blank'
      );
    });
    $('#result-panel-download-button-htm').click(function() {
      window.open(
        '/downloadsearchmetadata/' + APP.guid + '/?html',
        '_blank'
      );
    });
    $('#result-panel-download-button-kml').click(function() {
      window.open(
        '/downloadsearchresults/' + APP.guid + '/?kml',
        '_blank'
      );
    });
    $('#result-panel-download-button-kmz').click(function() {
      window.open(
        '/downloadsearchresults/' + APP.guid + '/?kmz',
        '_blank'
      );
    });
    $('#result-panel-download-button-xml').click(function() {
      window.open(
        '/downloadsearchmetadata/' + APP.guid + '/',
        '_blank'
      );
    });

    $('#cart-panel-download-button-shp').click(function() {
      window.open(
        '/downloadcart/?shp',
        '_blank'
      );
    });
    $('#cart-panel-download-button-htm').click(function() {
      window.open(
        '/downloadcartmetadata/?html',
        '_blank'
      );
    });
    $('#cart-panel-download-button-kml').click(function() {
      window.open(
        '/downloadcart/?kml',
        '_blank'
      );
    });
    $('#cart-panel-download-button-kmz').click(function() {
      window.open(
        '/downloadcart/?kmz',
        '_blank'
      );
    });
    $('#cart-panel-download-button-xml').click(function() {
      window.open(
        '/downloadcartmetadata/',
        '_blank'
      );
    });
    // setup daterange widget
    $('#date_range').daterange();
  });
  </script>
{% endblock %}
