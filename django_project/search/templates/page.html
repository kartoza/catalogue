{% extends "base-fluid.html" %}
{% load staticfiles %}
{% block body_load %}{% endblock %}

{% block content%}
      <div id="panel-toggles" class="btn-group">
          <button id="search-panel-toggle"
                  class="btn btn-info btn-large btn-left-panel active"
                  onclick="toggleSearchPanel();"
                  data-toggle="tooltip" title="Toggle Search Panel"
                  data-placement="bottom">
            <i class="icon-search"></i>
          </button>
          <button id="cart-panel-toggle"
                  class="btn btn-info btn-large btn-left-panel"
                  onclick="toggleCartPanel();"
                  data-toggle="tooltip" data-title="Toggle Cart Panel"
                  data-placement="bottom">
            <i class="icon-shopping-cart"></i>
          </button>
          <button id="map-help-button"
                  class="btn btn-info btn-large"
                  data-toggle="tooltip" title="Map Help"
                  data-placement="bottom">
            <i class="icon-question-sign"></i>
          </button>
        </div>
      <div id="search-panel">
        <div id="search-panel-content" class="well" style="max-height:40%;overflow-y:scroll;">
          <form id="catalogueSearch" action="{% url 'submitSearch' %}"
                class="accordion">
            <h5 class="text-center">Set Your Search Parameters</h5>
            <hr />
            {% csrf_token %}
            {{ searchform.geometry }}
            {{ searchform.selected_sensors }}
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse"
                   data-parent="#catalogueSearch"
                   href="#content-1">
                  <i class="icon-angle-down"></i> Choose Satellites
                </a>
              </div>
              {% include 'search_form/content-1.html' %}
            </div>
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse"
                   data-parent="#catalogueSearch"
                   href="#content-2">
                  <i class="icon-angle-down"></i> Add Date Ranges
                </a>
              </div>
              {% include 'search_form/content-2.html' %}
            </div>
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse"
                   data-parent="#catalogueSearch"
                   href="#content-3">
                  <i class="icon-angle-down"></i> Define Search Area (or digitize on map)
                </a>
              </div>
              {% include 'search_form/content-3.html' %}
            </div>
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse"
                   data-parent="#catalogueSearch"
                   href="#content-4">
                  <i class="icon-angle-down"></i> Set Max. Cloud Cover
                </a>
              </div>
              {% include 'search_form/content-4.html' %}
            </div>
            <div class="accordion-group">
              <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse"
                   data-parent="#catalogueSearch"
                   href="#content-5">
                  <i class="icon-angle-down"></i> Other Options
                </a>
              </div>
              {% include 'search_form/content-5.html' %}
            </div>
          </form>
        </div>
        <div id="search-summary-container" class="well">
          <h5 class="text-center">Search Settings Summary</h5>
          <hr/>
          <div id="search-summary"></div>
          <div id="search-buttons" class="text-center"
               style="margin-top: 20px;">
            <hr/>
            <button class="btn btn-success"
                    onclick="submitSearchForm();"
                    data-toggle="tooltip" title="Run Search"
                    data-placement="top">
              <i class="icon-play"></i>
            </button>
            <button class="btn btn-warning"
                    data-toggle="tooltip" title="Reset Search Parameters"
                    onclick="resetSearchForm()"
                    data-placement="top">
              <i class="icon-refresh"></i>
            </button>
            <button id="search-panel-help-button"
                    class="btn btn-info"
                    data-toggle="tooltip" title="Search Help"
                    data-placement="top">
              <i class="icon-question-sign"></i>
            </button>
          </div>
        </div>
      </div>
      <div id="cart-panel">
        <div id="cart-container" class="well"></div>
        <div id="cart-sub-panel" class="well text-center">
          <button class="btn btn-success">
            <i class="icon-ok"></i> Place Order
          </button>
          <button id="cart-panel-download-button"
                  onclick="showCartDownloadOptions();"
                  class="btn btn-info">
            <i class="icon-download"></i> Download Order
          </button>
          <div id="cart-panel-btns">
            <hr />
            <p>Please choose your download format</p>
            <div class="btn-group">
              <button id="cart-panel-download-button-shp"
                      class="btn btn-info"
                      data-toggle="tooltip"
                      data-title="Download as SHP"
                      data-placement="top">SHP
              </button>
              <button id="cart-panel-download-button-kml"
                      class="btn btn-info"
                      data-toggle="tooltip"
                      data-title="Download as KML"
                      data-placement="top">KML
              </button>
              <button id="cart-panel-download-button-kmz"
                      class="btn btn-info"
                      data-toggle="tooltip"
                      data-title="Download as KMZ"
                      data-placement="top">KMZ
              </button>
              <button id="cart-panel-download-button-xml"
                      class="btn btn-info"
                      data-toggle="tooltip"
                      data-title="Download as XML"
                      data-placement="top">XML
              </button>
              <button id="cart-panel-download-button-htm"
                      class="btn btn-info"
                      data-toggle="tooltip"
                      data-title="Download as HTM"
                      data-placement="top">HTM
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="result-panel" class="well">
        <div id="result-panel-download-button">
          <button class="btn btn-success btn-large btn-right-panel"
                  data-toggle="tooltip" data-title="Toggle Download Options"
                  data-placement="left">
            <i class="icon-download-alt"></i>
          </button>
        </div>
        <div id="result-panel-download-button-shp" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as SHP"
                  data-placement="left">SHP</button>
        </div>
        <div id="result-panel-download-button-kml" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as KML"
                  data-placement="left">KML</button>
        </div>
        <div id="result-panel-download-button-kmz" class="downloadoptions">
          <p class="btn btn-info btn-right-panel" data-toggle="tooltip"
             data-title="Download as KMZ"
             data-placement="left">KMZ</p>
        </div>
        <div id="result-panel-download-button-xml" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as XML"
                  data-placement="left">XML</button>
        </div>
        <div id="result-panel-download-button-htm" class="downloadoptions">
          <button class="btn btn-info btn-right-panel" data-toggle="tooltip"
                  data-title="Download as HTM"
                  data-placement="left">HTM</button>
        </div>
        <div id="result-panel-toggle">
          <button class="btn btn-info btn-large btn-right-panel"
                  onclick="toggleResultPanel();"
                  data-toggle="tooltip" data-placement="left"
                  title="Toggle Results Panel">
            <i class="icon-list"></i>
          </button>
        </div>
        <div class="navigation">
          <div id="searchPrev" class="btn searchPrev" style="float:left; display: none;">
            <i class="icon-chevron-left"></i>
          </div>
          <div id="SearchShare" style="float:left; display: none;" class="btn">
            <i class="icon-share"></i>
          </div>
          <div id="resetZoom" style="float:left; display: none;" class="btn resetZoom">
            <i class="icon-eye-close"></i>
          </div>
          <div class="position" id="resultsPosition"></div>
          <div id="searchNext" class="btn searchNext" style="float:right; display: none;">
            <i class="icon-chevron-right"></i>
          </div>
        </div>
        <div id="results-container"></div>
      </div>

      <div id="map"></div>
      <div id="svg_layer">
        <svg id="svg" style="width:100%; height: 100%;"></svg>
      </div>
      <input type="hidden" id="id_geometry" />
      <div id="map-controls">
        <div id="map-layerswitcher-control">
          <button class="btn btn-info btn-large right icon-globe"></button>
        </div>
        <div id="map-navigation"></div>
      </div>
      <div id="map-controls2" class="blackalpha60">
        <div id="map-control-position"></div>
        <div id="map-control-scalebar"></div>
      </div>
      <div id="map-layerswitcher" class="drop-shadow"></div>
  <div id="ajax-modal" class="modal hide fade" tabindex="-1"></div>
  <div id="imageBox" class="modal container hide fade text-center"  tabindex="-2">
    <img id="imageBoximage" src="" />
  </div>
{% endblock%}

{% block extrajs %}
  {{ block.super }}
  <script type="text/javascript">
    APP.searchresults = {{ searchlistnumber|safe }};
    {% if user.is_authenticated %}
      var UserLoged = true;
    {% else %}
      var UserLoged = false;
    {% endif %}
  </script>
  <script type="text/javascript" src="{% static 'js/search.js' %}"></script>
  <script>
  $( document ).ready(function() {
    $('button[data-toggle="tooltip"]').tooltip();
    myMap = new APP.SansaMap('map');
    searchLayer = new APP.SearchLayer(myMap);
    geoSearchLayer = new APP.GeoSearchLayer(myMap);
    {% if mysearch %}
      APP.guid = '{{ mysearch.guid }}';
      $APP.trigger('collectionSearch', {
          offset: 0
      });
      openResultPanel();
    {% endif %}

    $(".olButton").tooltip({"placement": "top"});

    defaultPanelState();
    $('.listTree').listTree( {{ listreeoptions|safe }} , { "startCollapsed": true, "selected": {{ selected_options|safe }} });
    $('#results-container').perfectScrollbar( { wheelSpeed: 20 } );
    $('#cart-container').perfectScrollbar( { wheelSpeed: 20 } );
    $('#id_start_datepicker').datepicker({
      autoclose: true,
      startView: 2,
      format: "dd/mm/yyyy"
    });
    $('#id_end_datepicker').datepicker({
      autoclose: true,
      startView: 2,
      format: "dd/mm/yyyy"
    });
    $('#result-panel-download-button').click(function() {
      toggleResultDownloadButton();
    });
    $('#cart-panel-download-button').click(function() {
      toggleCartDownloadButton();
    });
    $('#map-layerswitcher-control').click(function() {
      toggleLayerSwitcher();
    });
    $('#result-panel-download-button-shp').click(function() {
      window.open(
        '/downloadsearchresults/' + APP.guid + '/?shp',
        '_blank'
      );
    });
    $('#result-panel-download-button-htm').click(function() {
      window.open(
        '/downloadsearchmetadata/' + APP.guid + '/?html',
        '_blank'
      );
    });
    $('#result-panel-download-button-kml').click(function() {
      window.open(
        '/downloadsearchresults/' + APP.guid + '/?kml',
        '_blank'
      );
    });
    $('#result-panel-download-button-kmz').click(function() {
      window.open(
        '/downloadsearchresults/' + APP.guid + '/?kmz',
        '_blank'
      );
    });
    $('#result-panel-download-button-xml').click(function() {
      window.open(
        '/downloadsearchmetadata/' + APP.guid + '/',
        '_blank'
      );
    });

    $('#cart-panel-download-button-shp').click(function() {
      window.open(
        '/downloadcart/?shp',
        '_blank'
      );
    });
    $('#cart-panel-download-button-htm').click(function() {
      window.open(
        '/downloadcartmetadata/?html',
        '_blank'
      );
    });
    $('#cart-panel-download-button-kml').click(function() {
      window.open(
        '/downloadcart/?kml',
        '_blank'
      );
    });
    $('#cart-panel-download-button-kmz').click(function() {
      window.open(
        '/downloadcart/?kmz',
        '_blank'
      );
    });
    $('#cart-panel-download-button-xml').click(function() {
      window.open(
        '/downloadcartmetadata/',
        '_blank'
      );
    });
    $('#search-panel-help-button').click(function() {
      APP.$modal.load('/searchformhelp/', '', function(){
        APP.$modal.modal();
      });
    });
    $('#map-help-button').click(function() {
      APP.$modal.load('/mapHelp/', '', function(){
        APP.$modal.modal();
      });
    });
    $("#SearchShare").popover({
      content: function() {
        return '<input type="text" value="' + window.location.host + '/search/' + APP.guid + '/" onclick="this.select();" />';
      },
      placement:'left',
      trigger: "click",
      html: true
    });
    // setup daterange widget
    $('#date_range').daterange();
    // setup search summary widget
    searchSummary = new APP.SearchSummary('#search-summary');
  });
  </script>
{% endblock %}
