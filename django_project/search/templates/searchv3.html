{% extends "base.html" %}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}

{% block extrajs %}

  {{ block.super }}

  <script type="text/javascript">
  /* <![CDATA[ */
  {# use init rather than jquery document.ready() for ie support! #}
  function init() {

    if (OpenLayers.Util.getBrowserName() == "msie" && !window.ieLoaded) {
      window.ieLoaded = true;
      setTimeout(init, 2000);
      return;
    }

    // Extra layer definitions passed in by view
    {% if myLayerDefinitions %}
      {% for myValue in myLayerDefinitions %}
      {{ myValue|safe }}
      {% endfor %}
    {% endif %}
    var myLayersList = {{myLayersList|safe}}
    // Here we use a predefined layer that will be kept up to date with URL changes
    var layerMapnik = new OpenLayers.Layer.OSM.Mapnik("Open Street Map");
    //myLayersList.unshift(layerMapnik); // add to start of array
    myLayersList.push(layerMapnik); // add to end of array

    {% if myLayersList %}
      setupSearchMap( myLayersList );
    {% endif %}
    mMap.setBaseLayer( {{ myActiveBaseMap }} );
    //setupMapHelpDialog();

    $('#OpenLayers_Control_MaximizeDiv_innerImage').css({'height':'100px'}); {# //dirty hack, OL sets 'style' element which cannot be overriden by CSS #}
    $("#map-container").mapResizer({'map':mMap});
  }
  /* ]]> */
  </script>

{% endblock %}

{% block body_load %}onload="init()"{% endblock %}

{% block content%}
    <div class="row-fluid">
        <div id="search-panel" class="span3">
            {% include "searchPanelv3.html" %}
        </div>
        <div class="span9">
            <div class="row-fluid">
                <div id="map-container" class="span12">
                    {% include "map_containerv3.html" %}
                </div>
            </div>
            <div class="row-fluid">
                <div id="search-results-container" class="span12">results container
                </div>
            </div>
            <div class="row-fluid">
                <div id="cart-container" class="span12">cart container
                </div>
            </div>
        </div>
    </div>
{% endblock%}