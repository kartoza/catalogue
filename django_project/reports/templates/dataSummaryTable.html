{% extends "base.html" %}
{% load staticfiles %}
{% load render_table from django_tables2 %}
{% block extrajs %}
    {{ block.super }}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

        // Set a callback to run when the Google Visualization API is loaded.
        google.setOnLoadCallback(drawChart);
        // Load the Visualization API and the piechart package.
        google.load('visualization', '1', {'packages': ['corechart']});

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            // Create our data table.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Sensor');
            data.addColumn('number', 'Records');
            data.addRows([
                {% for myRecord in myResultSet %}
                    {% if myRecord.id__count > 0 %}
                        ['{{myRecord}}', {{ myRecord.id__count }}],
                    {% endif %}
                {% endfor %}
                [null, null]]);

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            chart.draw(data, {
                width: 860,
                height: 400,
                is3D: true,
                title: 'Records by Sensor',
                backgroundColor: '#f5f5f5'
            });
        }
    </script>
{% endblock %}
{% block content %}
    <h2 class="centered">
        Summary of All Sensor-Based Catalogue Holdings
    </h2>
    <!--Div that will hold the pie chart-->
    <div class="row">
        <div id="chart_div" style="width: 860px; margin: auto;"></div>
    </div>
    <div class="row" style="margin-top:20px;">
        <p class="text-center">
            Click on <i class="icon-question-sign"></i> for a detailed summary for that sensor.
        </p>
    </div>
    <div class="container">
    <table class="table">
        <thead>
        </thead>
        <tbody>
        <tr>
            <th>Satellite</th>
            <th>Sensor</th>
            <th>Abbreviation</th>
            <th>Scene Count</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Info</th>
        </tr>
        {% for myRecord in myResultSet %}
            <tr>
                <td>{{ myRecord.satellite.name }}</td>
            <td>{{ myRecord.instrument_type.name }}</td>
            <td>{{ myRecord.satellite.abbreviation }}</td>
            <td>{{ myRecord.id__count }}</td>
            <td>{{ myRecord.start_date }}</td>
            <td>{{ myRecord.end_date }}</td>
            <td><a href='{% url "fact-sheet" myRecord.satellite.operator_abbreviation myRecord.instrument_type.operator_abbreviation %}'><i class="icon-question-sign"></i></a></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
    <div class="row">
        <div class="span8 offset2 text-right">
            <p><strong>Total Scenes: {{ total }}</strong></p>
        </div>
    </div>

    <div class="row-fluid center gap-bottom">
        <div id="order-list-buttonset" class="btn-group">
            <button id="download-btn" class="btn"
                    onclick='location="{{ myUrl }}?page=&pdf"'>
                <i class="icon-download"></i> Download as PDF
            </button>
        </div>
    </div>
{% endblock %}
