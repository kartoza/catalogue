{# included in search.html or pulled in by ajax #}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}
  <div class="row-fluid">
    <h3 class="centered"><i class="icon-search icon-large"></i> Search criteria</h3>
    <h6>(you can optionally digitise a search area above)</h6>
  </div>

  {% if myForm %}
    <input type="submit" class="btn" value="Search" class="default" name="_search" title="Click here to execute your search."/>

    <button class="btn" id="advancedSearch" title="Click here to switch between simple and advanced search modes." onClick="toggleAdvFields();">{% if myAdvancedFlag %}Toggle Simple Search{% else %}Toggle Advanced Search{% endif %}</button>


    <form enctype="multipart/form-data" action="{% url 'search' %}" method="post" id="search_form" class="form-horizontal">
      {% csrf_token %}
      {{myForm.geometry}}
      {% for field in myForm.visible_fields %}
        <div class="control-group">
          <label class="control-label" for="{{field.html_name}}">{{field.label}}</label>
          <div class="controls">
            {{field}}
          </div>
        </div>
      {% endfor %}
    </form>
  {% else %}
    Error search form could not be loaded.
  {% endif %}
<script type="text/javascript">
  var advFieldsFlag = false;

  $('[data-search-type="adv"]').each(function(){
    $(this).closest('.control-group').hide();
  });

  {% if myAdvancedFlag %}
  toggleAdvFields();
  advFieldsFlag = true;
  {% endif %}

  {% for myField in myForm %}
  {% ifnotequal myField.html_name "geometry" %}
  $("#{{myField.html_name}}Help").dialog({
    autoOpen: false,
    bgiframe: true,
    modal: true,
    buttons: {
      Ok: function() {
        $(this).dialog('close');
      }
    }
  });
    $('#{{myField.html_name}}Button').click(function(){
      $('#{{myField.html_name}}Help').dialog('open');
  });
  {% endifnotequal %}
  {% endfor %}


  function toggleAdvFields(){
    if(!advFieldsFlag){
      advFieldsFlag = true;
      $('[data-search-type="adv"]').each(function(){
        $(this).closest('.control-group').fadeIn('slow');
      });
    } else {
      advFieldsFlag = false;
      $('[data-search-type="adv"]').each(function(){
        $(this).closest('.control-group').fadeOut('slow');
      });
    }
  }
</script>