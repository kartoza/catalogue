{# Original code from Tim's SABIO project and copyright is retained by the original author #}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}
<script type="text/javascript">
function showOrder(theId) {
  theUrl = '/vieworder/' + theId + '/';
  $('#content').load(theUrl,'', zebraTables );
};
</script>
{% block content %}
<div class="row-fluid">
  <h2>Orders List</h2>
</div>
<div class="row-fluid center">
  <form name="frmShowOrder" method="get" action="" class="form-horizontal">
    <fieldset>
      <label for="order_id_text">Search orders:</label>
      <div class="input-append">
        <input name="order_id_text" type="text" size="6" maxlength="5" placeholder="Enter Order ID"/>
        <button class="btn btn-success" onclick="showOrder(forms['frmShowOrder'].order_id_text.value); return false;">Go!</button>
      </div>
    </fieldset>
  </form>
</div>
<div class="row-fluid center gap-bottom">
  <div id="order-list-buttonset" class="btn-group">
    <button id="download-btn" class="btn btn-small" onclick='location="{{ myUrl }}?page={{ myRecords.number}}&pdf"'><i class="icon-download"></i></button>
    {% if myUrl = '/listorders/' %} {# can't use url template tag for if evaluation #}
    <button class="btn btn-small monthly-btn" onclick='location="{% url 'orderMonthlyReport' myCurrentMonth|date:'Y'  myCurrentMonth|date:'m' %}"'><i class="icon-calendar"></i></button>
    <button class="btn btn-small summary-btn" onclick='location="{% url 'ordersSummary' %}"'><i class="icon-tasks"></i></button>
    {% endif %}
    <button id="tasking-view-btn" class="btn btn-small" onclick='location="{% url 'listTaskingRequests' %}"'><i class="icon-refresh"></i></button>
  </div>
  <span class="step-links btn-group">
    <a class="btn btn-small {% if not myRecords.has_previous %}disabled{% endif %}" href="{{myUrl}}?page={{ myRecords.previous_page_number }}"><i class="icon-backward"></i></a>
    <span class="current btn btn-small disabled btn-success">
      {{ myRecords.number }} of {{ myRecords.paginator.num_pages }}
    </span>
    <a class="btn btn-small {% if not myRecords.has_next %}disabled{% endif %}" href="{{myUrl}}?page={{ myRecords.next_page_number }}"><i class="icon-forward"></i></a>
  </span>
</div>
<div class="row-fluid">
<table class="table table-striped">
  <thead>
    <th>Id</th>
    <th>Date</th>
    <th>Status</th>
    <th>Placed by</th>
    <th>View</th>
  </thead>
  <tbody>
    {% for myOrder in myRecords.object_list %}
    <tr>
      <td>{{myOrder.id }}</td>
      <td>{{myOrder.order_date|date:"D, d M Y, H:m" }}</td>
      <td>{{myOrder.order_status}}</td>
      <td>{{myOrder.user.get_profile.firstname}} {{myOrder.user.get_profile.surname}}</td>
      <td>
        <a href="#" onclick='$("#content").load("{% url 'viewOrder' myOrder.id %}","", zebraTables );return false;'>
          <i class="icon-search"></i>
        </a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
<div class="row-fluid center">
  <span class="step-links btn-group">
    <a class="btn btn-small {% if not myRecords.has_previous %}disabled{% endif %}" href="{{myUrl}}?page={{ myRecords.previous_page_number }}"><i class="icon-backward"></i></a>
    <span class="current btn btn-small disabled btn-success">
      {{ myRecords.number }} of {{ myRecords.paginator.num_pages }}
    </span>
    <a class="btn btn-small {% if not myRecords.has_next %}disabled{% endif %}" href="{{myUrl}}?page={{ myRecords.next_page_number }}"><i class="icon-forward"></i></a>
  </span>
</div>
<script>
$('#download-btn').popover({
  placement:'left',
  trigger:'hover',
  content:'Click to download the entire list of your orders in PDF format',
  title:'Download as PDF'
});
$('#tasking-view-btn').popover({
  placement:'right',
  trigger:'hover',
  content:'Click to switch to the Tasking Request View',
  title:'Tasking Request View'
});
{% if myRecords.has_previous %}
$('.previous-btn').tooltip({
  placement:'top',
  title:'Previous Page'
});
{% endif %}
{% if myRecords.has_next %}
$('.next-btn').tooltip({
  placement:'top',
  title:'Next Page'
});
{% endif %}
$('.monthly-btn').tooltip({
  placement:'top',
  title:'Monthly Orders'
});
$('.summary-btn').tooltip({
  placement:'top',
  title:'Orders Summary'
});
</script>
{% endblock %}
