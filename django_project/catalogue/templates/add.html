  <script type="text/javascript">
    // <![CDATA[
    $.ui.dialog.prototype.options.bgiframe = true;
  function check_search_dates() { /* do nothing */ };
  function init() {
    if (OpenLayers.Util.getBrowserName() == "msie" && !window.ieLoaded) {
      window.ieLoaded = true;
      setTimeout(init, 2000);
      return;
    }  
    {% if myLayerDefinitions %}
    {% for myValue in myLayerDefinitions %}
    {{ myValue|safe }}
    {% endfor %}
    {% endif %}
    {% if myLayersList %}
    setupBaseMap();
    {% endif %}
    {% if myTaskingRequestFlag %}
    setupTaskingMap({{ myLayersList|safe }} );
    {% else %}
    mMap.addControl(new OpenLayers.Control.LayerSwitcher());
    mMap.addLayers( {{ myLayersList|safe }} );
    mVectorLayer = new OpenLayers.Layer.Vector("search_geometry");
    mMap.addLayer(mVectorLayer);
        // Add geometry specific panel of toolbar controls
        setupEditingPanel(mVectorLayer);

        mWKTFormat = new OpenLayers.Format.WKT();
        mVectorLayer.events.on({"featuremodified" : modifyWKT});
        mVectorLayer.events.on({"featureadded" : addWKT});

        var bounds = new OpenLayers.Bounds(16.3477, -35.2411, 33.3984, -21.9727);
        bounds.transform(new OpenLayers.Projection("EPSG:4326"), new OpenLayers.Projection("EPSG:900913"));
        mMap.zoomToExtent(bounds);
        {% endif %}
/*
      {% for myField in myForm %}
        $("#{{myField.html_name}}Help").dialog({
        autoOpen: false, 
        bgiframe: true,
        modal: true,
        buttons: {
          Ok: function() {
            $(this).dialog('close');
          }
        }
      });
      $('#{{myField.html_name}}Button').click(function() 
      { 
        $('#{{myField.html_name}}Help').dialog('open'); 
        return false;
      }); 
      {% endfor %}
      */
{# // add tooltip #}
$("#map-navigation-panel div[title]").tooltip('#maptooltip');
    $('#OpenLayers_Control_MaximizeDiv_innerImage').css({'height':'100px'}); {# //dirty hack, OL sets 'style' element which cannot be overriden by CSS #}
  };
  //]]>
  </script>
  <div id="maptooltip">&nbsp;</div>
  <div class="row-fluid">
    <div id="map-container">
      <div id="map"></div>
      <div id="map-panel" class="row-fluid gap-top">
        <div id="map-navigation-panel" class="span4 center"></div>
        <div id="map-location" class="span4 center"></div>
        <div class="olControlScalebar span4 center" id="map-scale"></div>
      </div>
    </div>
  </div>
  <div class="row-fluid gap-top">
    <form enctype="multipart/form-data" action="" method="post" accept-charset="utf-8" class="form-horizontal span12" id="add_form">
      {% csrf_token %}
      <h2 class="centered">{{ myTitle }}</h2>
      <p>{{  myMessage|safe }}</p>

      {# render forms based on context #}
      {% if myDeliveryDetailForm and myOrderForm %}

      {% for field in myDeliveryDetailForm %}
      <fieldset class="control-group {% if field.errors %}error{% endif %}">
        <label class="control-label" for="{{ field.auto_id }}">{{ field.label }}: </label>
        <div class="controls">
          {{ field }}
          {% if field.help_text %}
          <span class="help-inline ">{{ field.help_text }}</span>
          {% endif %}
          {% if field.errors %}
          <span class="help-inline ">{{ field.errors|striptags }}</span>
          {% endif %}
        </div>
      </fieldset>
      {% endfor %}
      {% for field in myOrderForm %}
      <fieldset class="control-group {% if field.errors %}error{% endif %}">
        <label class="control-label" for="{{ field.auto_id }}">{{ field.label }}</label>
        <div class="controls">
          {{ field }}
          {% if field.help_text %}
          <span class="help-inline ">{{ field.help_text }}</span>
          {% endif %}
          {% if field.errors %}
          <span class="help-inline ">{{ field.errors|striptags }}</span>
          {% endif %}
        </div>
      </fieldset>
      {% endfor %}

      {% else %}

      {% if myTaskingDeliveryDetailsForm and myTaskingForm %}

      {% for field in myTaskingDeliveryDetailsForm %}
      <fieldset class="control-group {% if field.errors %}error{% endif %}">
        <label class="control-label" for="{{ field.auto_id }}">{{ field.label }}</label>
        <div class="controls">
          {{ field }}
          {% if field.help_text %}
          <span class="help-inline ">{{ field.help_text }}</span>
          {% endif %}
          {% if field.errors %}
          <span class="help-inline ">{{ field.errors|striptags }}</span>
          {% endif %}
        </div>
      </fieldset>
      {% endfor %}
      {% for field in myTaskingForm %}
      <fieldset class="control-group {% if field.errors %}error{% endif %}">
        <label class="control-label" for="{{ field.auto_id }}">{{ field.label }}</label>
        <div class="controls">
          {{ field }}
          {% if field.help_text %}
          <span class="help-inline ">{{ field.help_text }}</span>
          {% endif %}
          {% if field.errors %}
          <span class="help-inline ">{{ field.errors|striptags }}</span>
          {% endif %}
        </div>
      </fieldset>
      {% endfor %}
      {{ myTaskingForm.media }}

      {% else %}

      {% for field in myForm %}
      <fieldset class="control-group {% if field.errors %}error{% endif %}">
        <label class="control-label" for="{{ field.auto_id }}">{{ field.label }}</label>
        <div class="controls">
          {{ field }}
          {% if field.help_text %}
          <span class="help-inline ">{{ field.help_text }}</span>
          {% endif %}
          {% if field.errors %}
          <span class="help-inline ">{{ field.errors|striptags }}</span>
          {% endif %}
        </div>
      </fieldset>
      {% endfor %}

      {% endif %}
      {% endif %}
      {% if mySubmitLabel %}
      <div class="control-group">
        <div class="controls">
          <button class="btn" type="submit" id="submitButton">{{ mySubmitLabel }}</button>
        </div>
      </div>
      {% else %}
      <div class="control-group">
        <div class="controls">
          <button class="btn" type="submit" id="submitButton">Save</button>
        </div>
      </div>
      {% endif %}
    </form>
  </div>
  <div class="row-fluid">
    {% if myShowCartContentsFlag %}
    <div id="cart" class="">
      {% include "cartContents.html" %}
    </div>
  </div>
  {% endif %}
  <!--
  {% for myField in myForm %}
    {# popup help for this field #}
    <div id="{{myField.html_name}}Help" title="{{ myField.label }}">
      <p>
        <span class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span>
        {{ myField.help_text }}
      </p>
    </div>
    {# popup ends #}
  {% endfor %}
-->
<script>
$('select, input, textarea, .help-inline ').addClass('span8');
</script>
