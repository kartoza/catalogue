<script type="text/javascript">
function showOrder(theId) {
  theUrl = '/vieworder/' + theId + '/';
  $('#main-content').load(theUrl,'', zebraTables );
};
</script>
{% block content %}
<div class="row-fluid">
  <h2>Orders List</h2>
</div>
<div class="row-fluid center">
  <form name="frmShowOrder" method="get" action="" class="form-horizontal">
    <fieldset>
      <label for="order_id_text">Search orders:</label>
      <div class="input-append">
        <input name="order_id_text" type="text" size="6" maxlength="5" placeholder="Enter Order ID"/>
        <button class="btn btn-success"
                onclick="showOrder(forms['frmShowOrder'].order_id_text.value); return false;">
          Go!
        </button>
      </div>
    </fieldset>
  </form>
</div>
<div class="row-fluid center gap-bottom">
  <div id="order-list-buttonset" class="btn-group">
    <button id="download-btn" class="btn"
            onclick='location="{{ myUrl }}?page={{ myRecords.number}}&pdf"'>
      <i class="icon-download"></i> Download as PDF
    </button>
    {% if myUrl == '/listorders/' %} {# can't use url template tag for if evaluation #}
    <button class="btn monthly-btn"
            onclick='location="{% url 'orderMonthlyReport' myCurrentMonth|date:'Y'  myCurrentMonth|date:'m' %}"'>
      <i class="icon-calendar"></i> View Monthly Reports
    </button>
    <button class="btn summary-btn"
            onclick='location="{% url 'ordersSummary' %}"'>
      <i class="icon-tasks"></i> View Orders Summary
    </button>
    {% endif %}
  </div>
</div>
<div class="row-fluid center">
  <span class="step-links btn-group">
    {% if myRecords.has_previous %}
      <a class="btn btn-small" href="{{myUrl}}?page={{ myRecords.previous_page_number }}"><i class="icon-chevron-left"></i></a>
    {% else %}
      <a class="btn btn-small disabled" href="#"><i class="icon-chevron-left"></i></a>
    {% endif %}
    <span class="current btn btn-small disabled btn-success">
      {{ myRecords.number }} of {{ myRecords.paginator.num_pages }}
    </span>
    {% if myRecords.has_next %}
      <a class="btn btn-small" href="{{myUrl}}?page={{ myRecords.next_page_number }}"><i class="icon-chevron-right"></i></a>
    {% else %}
      <a class="btn btn-small disabled" href="#"><i class="icon-chevron-right"></i></a>
    {% endif %}
  </span>
</div>
<div class="row-fluid">
<table class="table table-striped">
  <thead>
    <th>Id</th>
    <th>Date</th>
    <th>Status</th>
    {% if myUrl == '/listorders/' %}
    <th>Placed by</th>
    {% endif %}
    <th>View</th>
  </thead>
  <tbody>
    {% for myOrder in myRecords.object_list %}
    <tr>
      <td>{{myOrder.id }}</td>
      <td>{{myOrder.order_date|date:"D, d M Y, H:m" }}</td>
      <td>{{myOrder.order_status}}{% if myOrder.get_recent_history_date %}: {{ myOrder.get_recent_history_date|date:"D, d M Y, H:m" }}{% endif %}</td>
      {% if myUrl == '/listorders/' %}
      <td>{{myOrder.user.get_profile.firstname}} {{myOrder.user.get_profile.surname}}</td>
      {% endif %}
      <td>
        <a href="{% url 'viewOrder' myOrder.id %}">
          <i class="icon-search"></i>
        </a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
<div class="row-fluid center">
  <span class="step-links btn-group">
    {% if myRecords.has_previous %}
      <a class="btn btn-small" href="{{myUrl}}?page={{ myRecords.previous_page_number }}"><i class="icon-chevron-left"></i></a>
    {% else %}
      <a class="btn btn-small disabled" href="#"><i class="icon-chevron-left"></i></a>
    {% endif %}
    <span class="current btn btn-small disabled btn-success">
      {{ myRecords.number }} of {{ myRecords.paginator.num_pages }}
    </span>
    {% if myRecords.has_next %}
      <a class="btn btn-small" href="{{myUrl}}?page={{ myRecords.next_page_number }}"><i class="icon-chevron-right"></i></a>
    {% else %}
      <a class="btn btn-small disabled" href="#"><i class="icon-chevron-right"></i></a>
    {% endif %}

  </span>
</div>
<script>
{% if myRecords.has_previous %}
$('.previous-btn').tooltip({
  placement:'top',
  title:'Previous Page'
});
{% endif %}
{% if myRecords.has_next %}
$('.next-btn').tooltip({
  placement:'top',
  title:'Next Page'
});
{% endif %}
$('.monthly-btn').tooltip({
  placement:'top',
  title:'Monthly Orders'
});
$('.summary-btn').tooltip({
  placement:'top',
  title:'Orders Summary'
});
</script>
{% endblock %}
