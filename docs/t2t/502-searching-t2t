

% ----------------------------------------------

= Searching for data on the Catalogue =

== Basic Search ==

== Advanced Search ==

=== Optical Products ===

[img/advanced-search-optical.png]

An advanced search for optical products allows the user to create a refined
subset of OpticalProduct records based on various properties.
The options selected in the advanced search form are cumulative.

In the wireframe above, you can see the options available in advanced search.


==== Sensor Details ====

The sensor details area of the form allows the user to define which products
should be found based on the sensors that acquired them.

- When selecting one or more missions, the sensors, modes, types and bands
  entries will be filtered to show only those items permissible for the given
  missions.
- When selecting one or more sensors, the modes, types and bands entries will
  be filtered to show only those items permissible for the given sensors.
- When selecting one or more types, the mode and band entries will be filtered
  to show only those items permissible for the given types.
- When selecting one or more modes, the band entries will be filtered to show
  only those items permissible for the given modes.
- The Mission, Mission Sensor, Type and Mode selectors are constrained to show
  only non-radar products (based on MissionSensor::is_radar property).
-

==== Image Details ====

The image details area of the form allows the user to define which products
should be found based on the product / image properties.

**Cloud cover** can optionally be used to filter products that have been determined
to have less than a given amount of cloud cover. Images with NULL cloud_cover
will be assumed to have 100% cloud cover for purposes of filtering. If the
checkbox next to the cloud cover slider is unchecked, cloud cover will be
ignored when filtering.

The **acquisition angle** is used to limit search results to products that were
acquired with the sensor orientated between a range of viewing angles. Images
with NULL sensor_viewing_angle will be assumed to be excluded when filtering by
sensor viewing angle. If either the min or max value is unpopulated, this will
be ignored in the search.

**Geometric accuracy** is used to filter products based on image pixel size. On a
technical note, the pixel size is determined by checking the
GenericImageryProduct::geometric_resolution (which is an inherited property of
optical product). The reason this is used rather than the
AcquisitionMode::geometric_resolution is that the product may have been
resampled during processing so (with the exception of level 1A products), the
resolution may not correspond to the acquisition mode any more. For ease of
use, geometric accuracy is grouped as shown in the table below, and the user
may select a single entry from this list.

|| Class | Value Range |
| < 1m | 0 - 1000mm |
| 1m - 7m | 1001 - 7000mm |
| 7m - 25m | 7001 - 25000mm |
| 25m - 70m | 25001 - 70000mm |
| 70m - 1km | 70001 - 1000000mm |
| > 1km | 1000000mm + |

**Note:** Internally, geometric resolution is specified in mm 

**Wolfgang:** mm or m?


**Bands** is used to identify the spectral resolution of the products being
searched for. A user friendly grouping is listed in a select box allowing the
user to select a single band range. These are:

|| Name | Notes |
| Panchromatic | Single band imagery |
| Truecolour RGB (3) | Three bands representing red green blue |
| Multispectral (4-8) | 4 to 8 bands |
| Superspectral (9-40) | 9 to 40 bands |
| Hyperspectral (>40) | more than 40 bands |

Technical note: As with geometric accuracy, the number of bands used for filtering is taken
from  GenericImageryProduct::band_count rather than AcquisitionMode::band_count.


==== Row / Path Ranges ====

The specification of row and path ranges can be one in one of three ways:
+ A range e.g. [0,15] means include all rows/paths inclusively from 0 to 15.
+ A list e.g. 1,5,3 means include specifically row or paths numbered 1, 5 and 3.
+ A single item e.g. 10 means include only that row/path
+

The sematics of what constitutes a row and path (in a geospatial sense) varies
from sensor to sensor. The search algorithm makes no special allowance for this
so it should be noted that a row/path search of 30,50 for two different sensors
my return imagery covering disparate areas.

==== Processing levels ====

The products can be filtered according to their processing level. The list of
processing level list is not dynamic (i.e. it does not ajust its entries based
on mission, sensor etc. selections) as it would be prohibitively CPU intensive
to do so. As such there is no guarantee of being at least one product for each
of the listed processing levels.

One or more processing levels can be selected. If none are selected, it is
assumed that products at all levels should be queried when searching.

==== Geometry ====

A geometry can be defined for a search in one of four ways:
+ Digitising an area on the map directly
+ Uploading a shapefile or kml demarcating the area of interest
+ Specifying point and radius geometry in an input box
+ Specifying a bounding box in an input box
+

[img/sac01.png]

For digitising, the user should select the 'capture polygon' tool on the map.

For the geometry upload functions, only the first feature in the uploaded
shapefile / kml will be used. The shapefile should have a polygon geometry type
and have a Coordinate Reference System of EPSG:4326 (Geographic WGS84).

The input box for geometry can be used to create a circular geometry by
entering the coordinate of the center point and a radius in kilometers. For example:

```
20.5,-32.3,100
```

The values should be entered as easting (use negative number to indicate west),
northing (use negative number to indicate south), radius (in km). The
easting/northing values are specified in decimal degrees.

Finally, the bounding box can also be entered in the form:

```
xmin,ymin,xmax,ymax
```

For example:

```
20,-34,22,-32
```

==== Date Ranges ====

When conducting a search with the advanced search tool, the user can specify
one or more date ranges. The start date for any date range will be restricted
to be no earlier **1 January 1972**. The end date will be restricted to be no
later than the current date. No facility is made for including time in the date
range.

The process of defining date ranges consists of:
- Selecting a start date in the 'start' calendar
- Selecting an end date in the 'end' calendar
- Clicking the 'add' icon to add the date range to the range list
-

The user can remove a range from the list by selecting it and clicking the
'remove' icon.


==== Executing the search ====

Once the user has completed the search definition process, pressing the
'search' button will cause the search request to be posted to the server. If
there are any validation errors, the user will be returned to the search form
and the validation errors will be indicated. Assuming there were no errors, the
user is redirected to the search results page.

== Radar Search ==

[img/advanced-search-radar.png]

Radar products share many properties in common with Optical products, so you
should read the description of the Advanced Search for Optical Products above
first. There are four principle differences in the Radar Search dialog:
+ There is no option to choose a cloud cover rating.
+ There is an option added for polarisation mode.
+ Acquisition angle is replaced with incidence angle (RadarProduct::incidence_angle).
+ The Mission, Mission Sensor, Type and Mode selectors are constrained to show
  only radar products (based on MissionSensor::is_radar property).
+

**Note:** Wolfgang to confirm if row/path, spatial resolution and bands are
still relevant to radar.


== Generic Imagery Search ==

[img/advanced-search-generic.png]


== GeospatialProduct Search ==

[img/advanced-search-geospatial.png]

